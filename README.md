# 🔔 ClosingBell v5.0 - 종가매매 스크리너

종가매매 전략을 위한 자동 스크리닝 시스템입니다.

## 🎯 v5.0 핵심 변경사항

### 소프트 필터 방식 (점수제)
- **하드 필터 최소화**: TV200 조건검색 + 하락종목만 제외
- **100점 만점 점수제**: 모든 조건을 점수로 반영
- **등급 시스템**: S/A/B/C/D 등급 자동 분류
- **매도전략 추천**: 등급별 시초가 매도비율, 목표가, 손절가 자동 추천

## 📊 점수 체계 (100점 만점)

### 핵심 지표 (90점)
| 지표 | 최적 조건 | 배점 |
|------|----------|------|
| CCI | 160~180 | 15점 |
| 등락률 | 2~8% | 15점 |
| 이격도 | 2~8% | 15점 |
| 연속양봉 | 2~3일 | 15점 |
| 거래량비율 | 1.5~3배 | 15점 |
| 캔들품질 | 양봉+짧은윗꼬리 | 15점 |

### 보너스 (10점)
| 조건 | 배점 |
|------|------|
| CCI 상승중 | +4점 |
| MA20 3일 상승 | +3점 |
| 고가 ≠ 종가 | +3점 |

## 🏆 등급별 매도전략

> **원칙**: 확신 높을수록 오래 홀딩, 확신 낮을수록 빨리 익절/손절

| 등급 | 점수 | 시초매도 | 홀딩 | 목표익절 | 손절 | 신뢰도 |
|------|------|---------|------|---------|------|--------|
| 🏆 S | 85+ | 30% | 70% | +4% | -3% | 매우 높음 |
| 🥇 A | 75-84 | 40% | 60% | +3% | -2.5% | 높음 |
| 🥈 B | 65-74 | 50% | 50% | +2.5% | -2% | 중상 |
| 🥉 C | 55-64 | 70% | 30% | +2% | -1.5% | 중간 |
| ⚠️ D | <55 | 100% | 0% | - | -1% | 낮음 |

## 🚀 사용법

### 설치

```bash
# 의존성 설치
pip install -r requirements.txt

# 환경 변수 설정 (.env 파일)
cp .env.example .env
# KIS API 키, Discord 웹훅 URL 등 설정
```

### 실행

```bash
# 스케줄러 모드 (12:30, 15:00, 16:30 자동 실행)
python main.py

# 즉시 스크리닝 실행
python main.py --run

# 테스트 모드 (TOP5 + 등급/매도전략, 알림 없음)
python main.py --run-test

# 수동 학습 실행
python main.py --learn

# 설정 검증
python main.py --validate

# DB 초기화
python main.py --init-db
```

### 출력 예시

```
═══════════════════════════════════════════════════════════════
🏆 TOP 5 종목 (등급 + 매도전략)
═══════════════════════════════════════════════════════════════

#1 📌 삼성전자 (005930)
────────────────────────────────────────────────────────────────
   💰 현재가: 72,500원 (+3.21%)
   📊 총점: 87.3점 🏆 S등급
   💵 거래대금: 4,532억원

   [핵심 지표] (90점 만점)
      CCI(165):        14.5/15
      등락률(3.2%):     14.8/15
      이격도(4.1%):     14.7/15
      연속양봉(2일):    15.0/15
      거래량비(1.8x):   14.6/15
      캔들품질:         13.7/15
      ────────────────────
      소계:             87.3/90

   [보너스] (10점 만점)
      CCI 상승중 ✅:     4.0/4
      MA20 3일↑ ✅:      3.0/3
      고가≠종가 ✅:      3.0/3
      ────────────────────
      소계:             10.0/10

   [매도 전략] 신뢰도: 매우 높음
      📈 시초가 30% 매도
      🎯 나머지 70%: 목표가 +4%
      🛡️ 손절가: -3%
```

## 📁 프로젝트 구조

```
closingbell_v5/
├── main.py                    # 메인 진입점
├── src/
│   ├── config/
│   │   ├── constants.py       # v5 상수 정의
│   │   ├── settings.py        # 환경 설정
│   │   └── validator.py       # 설정 검증
│   ├── domain/
│   │   ├── models.py          # 데이터 모델
│   │   ├── indicators.py      # 기술적 지표 계산
│   │   └── score_calculator_v5.py  # ⭐ v5 점수 계산기
│   ├── services/
│   │   ├── screener_service_v5.py  # ⭐ v5 스크리너 서비스
│   │   ├── backtest_service.py     # 백테스트
│   │   └── learner_service.py      # 학습 서비스
│   ├── adapters/
│   │   ├── kis_client.py      # 한국투자증권 API
│   │   └── discord_notifier.py # Discord 알림
│   ├── infrastructure/
│   │   ├── database.py        # SQLite DB
│   │   ├── repository.py      # 데이터 저장소
│   │   └── scheduler.py       # 스케줄러
│   └── utils/
│       └── stock_filters.py   # 종목 필터
├── dashboard/                  # Streamlit 대시보드
├── docs/                       # 설계 문서
└── tests/                      # 테스트
```

## 🔧 환경 변수

```env
# 한국투자증권 API
KIS_APP_KEY=your_app_key
KIS_APP_SECRET=your_app_secret
KIS_ACCOUNT_NO=your_account_number

# Discord
DISCORD_WEBHOOK_URL=your_webhook_url

# 스크리닝 설정
CONDITION_NAME=TV200
MIN_TRADING_VALUE=200
TOP_N_COUNT=5
```

## 📈 그리드 서치 최적 조건 (60.15% 승률)

2024년 백테스트 기반 그리드 서치 결과:

- **CCI**: 160~180 (170 최적)
- **이격도**: 2~8% (5% 최적)
- **등락률**: 2~8% (5% 최적)
- **연속양봉**: ≤4일 (2~3일 최적)
- **거래대금**: ≥200억
- **거래량비율**: ≥1.0배 (1.5~3배 최적)
- **CCI 상승중**: 필수
- **MA20 3일 상승**: 필수
- **고가≠종가**: 권장

## 📜 버전 히스토리

### v5.0 (현재)
- 소프트 필터 방식 전환 (점수제)
- 100점 만점 시스템
- 등급(S/A/B/C/D) 도입
- 등급별 매도전략 자동 추천

### v4.0
- 그리드 서치 최적화 반영
- 하드 필터 강화

### v3.0
- 가중치 자동 학습 시스템

### v2.0
- TV200 조건검색 연동

### v1.0
- 초기 버전

## ⚠️ 주의사항

- 이 시스템은 투자 참고용이며, 투자의 책임은 사용자에게 있습니다.
- 시장 상황에 따라 최적 조건이 변할 수 있습니다.
- 과거 수익률이 미래 수익을 보장하지 않습니다.

## 📞 문의

GitHub Issues를 통해 버그 리포트 및 기능 제안을 해주세요.
