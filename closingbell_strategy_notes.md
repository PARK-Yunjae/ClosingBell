# ClosingBell 종가매매 전략 분석 및 개선 노트

> 작성일: 2025-01-07  
> 목적: 현재 전략 평가 및 향후 개선 방향 기록

---

## 1. 현재 전략 요약

### 1.1 종목 선정 기준 (진입)

| 지표 | 조건 | 근거 |
|------|------|------|
| 거래대금 | 300억 이상 | 유동성 확보, 슬리피지 방지 |
| CCI(14) | 180 근처 | 상승 모멘텀 확인 |
| MA20 | 우상향 | 추세 확인 |
| 캔들 | 양봉, MA20 위 안착 | 매수세 확인 |
| 윗꼬리 | 짧을수록 좋음 | 매도 압력 적음 |
| 당일 상승률 | 5~20% | 적정 모멘텀 (과열 아님) |
| 가격 | 2,000원 이상 | 동전주 제외 |

### 1.2 매도 전략 (청산)

**현재 사용 중:**
```
절반(50%): 익일 시초가 매도
절반(50%): 트레일링 스탑 (-3% 손절 / +3% 익절, 고점 대비 -2% 매도)
```

**과거 시도했던 것들:**
- 전량 시초가 매도 → 수익 제한
- -1% / +5% 조건 매매 → 손절 너무 타이트
- 복잡한 지표 추가 → 오히려 성과 악화

---

## 2. 전략 평가

### 2.1 잘하고 있는 점 ✅

**1) 단순함 유지**
- 복잡한 지표 추가 시 성과 악화 경험
- 핵심 지표(CCI, MA20, 캔들)만 사용하는 것이 정답
- 과적합(overfitting) 위험 회피

**2) 매도 전략 체계화**
- 종가매매에서 매도 전략이 수익의 70% 결정
- 분할 매도로 리스크 분산
- 실전 경험 기반 최적화

**3) 논리적 일관성**
- CCI: 모멘텀 확인
- MA20: 추세 확인  
- 양봉/윗꼬리: 수급 확인
- 세 가지가 서로 보완하는 구조

### 2.2 주의해야 할 점 ⚠️

**1) CCI 180 고정값의 한계**
```
시장 상황별로 최적 CCI가 다름:
- 강세장: 150~200도 OK
- 약세장: 100~150이 더 안전
- 횡보장: CCI 자체가 무의미할 수 있음
```

**2) 과거 실패 원인 분석**
```
외인 수급 추가 실패 이유:
→ 데이터 지연 (장 마감 후 확정, 종가매매에 늦음)

뉴스 분석 추가 실패 이유:
→ 이미 가격에 반영됨 (효율적 시장 가설)

회전율/거래량 추가 실패 이유:
→ 거래대금과 중복되는 정보 (노이즈만 추가)
```

---

## 3. 향후 개선 아이디어

### 3.1 시장 상황 필터 (간단한 것 하나만)

```python
# 코스닥 지수가 MA20 위/아래로 시장 상황 판단
def get_market_regime():
    if kosdaq_close >= kosdaq_ma20:
        return 'BULL'  # 상승장
    else:
        return 'BEAR'  # 하락장

# 적용 방법
if market == 'BULL':
    # 현재 전략 유지 (공격적)
    sell_ratio = 0.5  # 시초가 50%
else:
    # 보수적 모드
    sell_ratio = 1.0  # 시초가 100% (트레일링 없이)
```

**장점:** 하락장에서 손실 제한, 복잡하지 않음

### 3.2 CCI 범위 유동화

```python
# 고정값 대신 범위 사용
CCI_OPTIMAL_RANGE = (140, 200)  # 180 ± 40

# 또는 시장 상황별 차등
if market == 'BULL':
    CCI_RANGE = (160, 220)  # 공격적
else:
    CCI_RANGE = (120, 180)  # 보수적
```

### 3.3 등급별 차등 매도

```python
# 종목 확신도에 따라 매도 비율 조절
def get_sell_strategy(grade, score):
    if grade == 'S' or score >= 40:
        # 확신 높음 → 더 오래 보유
        return {'시초': 0.3, '트레일링': 0.7, '트레일링폭': -3}
    
    elif grade == 'A' or score >= 35:
        # 중간 → 균형
        return {'시초': 0.5, '트레일링': 0.5, '트레일링폭': -2}
    
    else:
        # 확신 낮음 → 빨리 정리
        return {'시초': 0.7, '트레일링': 0.3, '트레일링폭': -2}
```

### 3.4 손익비 개선 아이디어

```python
# 현재: -3% / +3% (손익비 1:1)
# 개선안: 승률에 따라 조정

# 승률 60% 이상이면 손익비 낮춰도 됨
stop_loss = -2%
take_profit = +4%  # 손익비 1:2

# 승률 50% 미만이면 손익비 높여야 함
stop_loss = -2%
take_profit = +6%  # 손익비 1:3
```

---

## 4. 하지 말아야 할 것들 🚫

### 4.1 지표 과다 추가
```
❌ 외인/기관 수급 (데이터 지연)
❌ 뉴스 감성 분석 (이미 반영됨)
❌ 섹터 로테이션 (너무 복잡)
❌ RSI, MACD, 볼린저 등 중복 지표
```

### 4.2 과최적화
```
❌ 백테스트에서 완벽한 파라미터 찾기
❌ 특정 기간에만 맞는 전략
❌ 너무 많은 조건 조합
```

### 4.3 감정적 대응
```
❌ 연패 후 전략 급변경
❌ 연승 후 과신/베팅 증가
❌ 시장 뉴스에 휘둘림
```

---

## 5. 백테스트 결과 해석 가이드

### 5.1 상관관계 해석

```
양의 상관관계 (+0.03 이상):
→ 해당 점수가 높을수록 익일 수익률 높음
→ 가중치 올리기

음의 상관관계 (-0.03 이하):
→ 해당 점수가 높을수록 오히려 수익률 낮음
→ 가중치 낮추거나 제거 고려

무상관 (-0.03 ~ +0.03):
→ 예측력 없음
→ 기본 가중치(1.0) 유지
```

### 5.2 가중치 적용 기준

```python
# 상관관계 기반 가중치 조정 예시
correlations = {
    'cci_value': +0.02,   # 약한 양의 상관 → 1.0 유지
    'cci_slope': +0.05,   # 강한 양의 상관 → 1.5~2.0
    'ma20_slope': +0.03,  # 중간 양의 상관 → 1.2
    'candle': +0.01,      # 거의 무상관 → 1.0
    'change': -0.02,      # 약한 음의 상관 → 0.7~0.8
}
```

### 5.3 결과 신뢰도 체크

```
✅ 신뢰할 수 있는 결과:
- 샘플 수 1,000개 이상
- 거래일 500일 이상 분포
- 여러 시장 상황 포함 (상승/하락/횡보)

⚠️ 주의해야 할 결과:
- 샘플 수 100개 미만
- 특정 기간에 편중
- 극단적 가중치 (0.5 이하 또는 3.0 이상)
```

---

## 6. 실전 적용 체크리스트

### 6.1 백테스트 완료 후

- [ ] 상관관계 부호 및 크기 확인
- [ ] 최적 가중치 범위 확인 (극단값 주의)
- [ ] 샘플 수 및 기간 분포 확인
- [ ] 기존 전략 대비 개선폭 확인

### 6.2 ClosingBell 적용

```sql
-- weight_config 테이블 업데이트
UPDATE weight_config SET weight = ? WHERE indicator = 'cci_value';
UPDATE weight_config SET weight = ? WHERE indicator = 'cci_slope';
UPDATE weight_config SET weight = ? WHERE indicator = 'ma20_slope';
UPDATE weight_config SET weight = ? WHERE indicator = 'candle';
UPDATE weight_config SET weight = ? WHERE indicator = 'change';
```

### 6.3 모니터링

- [ ] 1주일 후 실제 승률 확인
- [ ] 2주일 후 평균 수익률 확인
- [ ] 1개월 후 종합 평가 및 재조정 검토

---

## 7. 핵심 요약

### 현재 전략 점수: ⭐⭐⭐⭐ (4/5)

**강점:**
- 단순하고 논리적
- 실전 검증 완료
- 리스크 관리 체계 있음

**개선 여지:**
- 시장 상황별 대응 추가
- 등급별 차등 매도 적용
- CCI 범위 유동화

### 최종 조언

> "더 추가하면 오히려 망할 확률이 높다"

현재 전략이 이미 핵심을 잘 잡고 있습니다.  
백테스트 결과를 보고 **가중치 미세 조정** 정도만 하는 것을 권장합니다.

---

*이 문서는 향후 전략 개선 시 참고용으로 작성되었습니다.*