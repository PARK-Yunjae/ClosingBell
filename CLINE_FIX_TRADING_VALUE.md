# Cline í”„ë¡¬í”„íŠ¸ - ê±°ëž˜ëŒ€ê¸ˆ ì¡°íšŒ ë¬¸ì œ í•´ê²°

## ðŸ”´ ë¬¸ì œ ìƒí™©
ê±°ëž˜ëŒ€ê¸ˆ 300ì–µ ì´ìƒ ì¢…ëª©ì´ **16ê°œë§Œ** ì¡°íšŒë¨.
í•œêµ­íˆ¬ìžì¦ê¶Œ HTS/MTSì—ì„œëŠ” **200ê°œ ì´ìƒ** í™•ì¸ë¨.

---

## ðŸ” ì˜ˆìƒ ì›ì¸

### ì›ì¸ 1: API ì‘ë‹µ ê°œìˆ˜ ì œí•œ (ê°€ìž¥ ìœ ë ¥)
í•œíˆ¬ API `volume-rank`ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ **30ê°œë§Œ** ë°˜í™˜í•  ìˆ˜ ìžˆìŒ.
â†’ íŽ˜ì´ì§• ì²˜ë¦¬ ë˜ëŠ” ë‹¤ë¥¸ API ì‚¬ìš© í•„ìš”

### ì›ì¸ 2: ê±°ëž˜ëŒ€ê¸ˆ ë‹¨ìœ„ ì˜¤ë¥˜
- API ì‘ë‹µ: `acml_tr_pbmn` (ëˆ„ì  ê±°ëž˜ëŒ€ê¸ˆ)
- í˜„ìž¬ ì½”ë“œ: `/ 100_000_000` (ì–µì› ë³€í™˜)
- ì‹¤ì œ ë‹¨ìœ„ê°€ ë‹¤ë¥¼ ìˆ˜ ìžˆìŒ (ì› vs ì²œì› vs ë°±ë§Œì›)

### ì›ì¸ 3: ì‹œìž¥ êµ¬ë¶„ ì½”ë“œ
- í˜„ìž¬: `FID_COND_MRKT_DIV_CODE: "J"` (ì „ì²´)
- KOSPIë§Œ ë˜ëŠ” KOSDAQë§Œ ì¡°íšŒë  ìˆ˜ ìžˆìŒ

### ì›ì¸ 4: ìž¥ ë§ˆê° í›„ ë°ì´í„°
- ìž¥ ë§ˆê° í›„ API ì‘ë‹µì´ ì œí•œë  ìˆ˜ ìžˆìŒ

---

## ðŸš€ Step 1: ë””ë²„ê¹… - API ì›ë³¸ ì‘ë‹µ í™•ì¸

```
kis_client.pyì˜ get_top_trading_value_stocks ë©”ì„œë“œì—ì„œ
API ì›ë³¸ ì‘ë‹µì„ ì¶œë ¥í•˜ëŠ” ë””ë²„ê¹… ì½”ë“œë¥¼ ì¶”ê°€í•´ì¤˜.

1. APIê°€ ëª‡ ê°œì˜ ì¢…ëª©ì„ ë°˜í™˜í•˜ëŠ”ì§€ í™•ì¸
2. ê° ì¢…ëª©ì˜ ê±°ëž˜ëŒ€ê¸ˆ ì›ë³¸ê°’(acml_tr_pbmn) ì¶œë ¥
3. ë‹¨ìœ„ í™•ì¸ (ì–µì›ì¸ì§€, ì›ì¸ì§€)

ë””ë²„ê¹… ì‹¤í–‰:
python -c "
from src.adapters.kis_client import get_kis_client
client = get_kis_client()

# ì›ë³¸ ì‘ë‹µ í™•ì¸
import requests
endpoint = '/uapi/domestic-stock/v1/quotations/volume-rank'
# ... API í˜¸ì¶œ í›„ output ì „ì²´ ì¶œë ¥
"
```

---

## ðŸš€ Step 2: ê±°ëž˜ëŒ€ê¸ˆ ìˆœìœ„ API ëŒ€ì‹  ë‹¤ë¥¸ ë°©ë²• ì‚¬ìš©

í•œíˆ¬ APIì—ì„œ ê±°ëž˜ëŒ€ê¸ˆ ìƒìœ„ ì¢…ëª©ì„ ì œëŒ€ë¡œ ê°€ì ¸ì˜¤ë ¤ë©´ **ì—¬ëŸ¬ ë²ˆ í˜¸ì¶œ**í•˜ê±°ë‚˜ **ë‹¤ë¥¸ API**ë¥¼ ì‚¬ìš©í•´ì•¼ í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

```
ê±°ëž˜ëŒ€ê¸ˆ ì¡°íšŒ ë¡œì§ì„ ìˆ˜ì •í•´ì¤˜.

ë°©ë²• A: ê±°ëž˜ëŒ€ê¸ˆ ìˆœìœ„ API íŽ˜ì´ì§•
- volume-rank APIê°€ íŽ˜ì´ì§•ì„ ì§€ì›í•˜ëŠ”ì§€ í™•ì¸
- ì§€ì›í•œë‹¤ë©´ ì—¬ëŸ¬ íŽ˜ì´ì§€ ì¡°íšŒ

ë°©ë²• B: ì „ ì¢…ëª© ì¡°íšŒ í›„ í•„í„°ë§
- í•œíˆ¬ APIì˜ 'ì—…ì¢…ë³„ ì „ì¢…ëª©' ì¡°íšŒ API ì‚¬ìš©
- KOSPI ì „ì¢…ëª© + KOSDAQ ì „ì¢…ëª© ì¡°íšŒ
- ê° ì¢…ëª©ì˜ í˜„ìž¬ê°€ì—ì„œ ê±°ëž˜ëŒ€ê¸ˆ í™•ì¸
- 300ì–µ ì´ìƒ í•„í„°ë§

ë°©ë²• Bê°€ ë” í™•ì‹¤í•¨. êµ¬í˜„í•´ì¤˜.

API ì •ë³´:
- KOSPI ì „ì¢…ëª©: /uapi/domestic-stock/v1/quotations/inquire-daily-indexchartprice
- ë˜ëŠ” ì—…ì¢…ë³„ ì¢…ëª© ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ API í™•ì¸ í•„ìš”
```

---

## ðŸš€ Step 3: ì‹¤ì œ í•´ê²° ë°©ë²• (ê¶Œìž¥)

```
ê±°ëž˜ëŒ€ê¸ˆ ìƒìœ„ ì¢…ëª© ì¡°íšŒ ë¡œì§ì„ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•´ì¤˜:

1. í•œíˆ¬ APIë¡œ KOSPI/KOSDAQ ê±°ëž˜ëŸ‰ ìƒìœ„ ì¢…ëª© ì¡°íšŒ
   - volume-rank APIë¡œ ìµœëŒ€í•œ ë§Žì´ ì¡°íšŒ (KOSPI + KOSDAQ ë³„ë„ í˜¸ì¶œ)
   
2. ê° ì‹œìž¥ë³„ë¡œ í˜¸ì¶œ:
   - KOSPI: FID_COND_MRKT_DIV_CODE = "J" â†’ "1" ë¡œ ë³€ê²½
   - KOSDAQ: FID_COND_MRKT_DIV_CODE = "2"
   - ë‘ ê²°ê³¼ í•©ì¹˜ê¸°

3. ê±°ëž˜ëŒ€ê¸ˆ ë‹¨ìœ„ í™•ì¸:
   - acml_tr_pbmn ê°’ì´ ì–´ë–¤ ë‹¨ìœ„ì¸ì§€ ë¡œê·¸ë¡œ ì¶œë ¥
   - ì‚¼ì„±ì „ìž ê°™ì€ ëŒ€í˜•ì£¼ì˜ ê±°ëž˜ëŒ€ê¸ˆìœ¼ë¡œ ë‹¨ìœ„ ì—­ì‚°

ìˆ˜ì •ëœ ì½”ë“œë¡œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰í•´ì¤˜.
```

---

## ðŸš€ Step 4: ê±°ëž˜ëŒ€ê¸ˆ ë‹¨ìœ„ í™•ì¸ ìŠ¤í¬ë¦½íŠ¸

```
ê±°ëž˜ëŒ€ê¸ˆ ë‹¨ìœ„ë¥¼ í™•ì¸í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë§Œë“¤ì–´ì¤˜.
scripts/debug_trading_value.py

ë‚´ìš©:
1. ì‚¼ì„±ì „ìž(005930) í˜„ìž¬ê°€ ì¡°íšŒ
2. acml_tr_pbmn ì›ë³¸ê°’ ì¶œë ¥
3. ì‹¤ì œ ê±°ëž˜ëŒ€ê¸ˆê³¼ ë¹„êµí•´ì„œ ë‹¨ìœ„ ì—­ì‚°
   - ì˜¤ëŠ˜ ì‚¼ì„±ì „ìž ê±°ëž˜ëŒ€ê¸ˆì´ ì•½ 5,000ì–µ ~ 1ì¡° ì •ë„
   - API ê°’ì´ 50000000000000 ì´ë©´ ì› ë‹¨ìœ„
   - API ê°’ì´ 5000000000000 ì´ë©´ ì› ë‹¨ìœ„ (ì¡° ë‹¨ìœ„)
   - API ê°’ì´ 5000 ì´ë©´ ì–µ ë‹¨ìœ„

python scripts/debug_trading_value.py
```

---

## ðŸ“‹ Clineì— ë°”ë¡œ ìž…ë ¥í•  ì¢…í•© í”„ë¡¬í”„íŠ¸

```
ê±°ëž˜ëŒ€ê¸ˆ 300ì–µ ì´ìƒ ì¢…ëª©ì´ 16ê°œë°–ì— ì•ˆ ë‚˜ì™€.
í•œêµ­íˆ¬ìžì¦ê¶Œ HTSì—ì„œëŠ” 200ê°œ ì´ìƒì¸ë° ë­”ê°€ ë¬¸ì œê°€ ìžˆì–´.

ë‹¤ìŒì„ í™•ì¸í•˜ê³  ìˆ˜ì •í•´ì¤˜:

1. kis_client.pyì˜ get_top_trading_value_stocksì—ì„œ API ì›ë³¸ ì‘ë‹µ í™•ì¸
   - output ë°°ì—´ì˜ ì´ ê°œìˆ˜
   - ì²« ë²ˆì§¸ ì¢…ëª©ì˜ acml_tr_pbmn ì›ë³¸ê°’

2. ê±°ëž˜ëŒ€ê¸ˆ ë‹¨ìœ„ í™•ì¸
   - ì‚¼ì„±ì „ìž(005930)ì˜ ê±°ëž˜ëŒ€ê¸ˆìœ¼ë¡œ ë‹¨ìœ„ ì—­ì‚°
   - ì› ë‹¨ìœ„ì¸ì§€, ì–µì› ë‹¨ìœ„ì¸ì§€

3. KOSPI, KOSDAQ ë³„ë„ í˜¸ì¶œë¡œ ìˆ˜ì •
   - í˜„ìž¬: FID_COND_MRKT_DIV_CODE = "J" (ì „ì²´)
   - ìˆ˜ì •: "1" (KOSPI) + "2" (KOSDAQ) ë³„ë„ í˜¸ì¶œ í›„ í•©ì¹˜ê¸°

4. API ì‘ë‹µ ê°œìˆ˜ ì œí•œ í™•ì¸
   - volume-rank APIê°€ ìµœëŒ€ ëª‡ ê°œ ë°˜í™˜í•˜ëŠ”ì§€

ë””ë²„ê¹… í›„ ë¬¸ì œë¥¼ ìˆ˜ì •í•˜ê³  ë‹¤ì‹œ í…ŒìŠ¤íŠ¸í•´ì¤˜.
```

---

## ðŸ’¡ ì°¸ê³ : í•œíˆ¬ API ê±°ëž˜ëŒ€ê¸ˆ ë‹¨ìœ„

í•œíˆ¬ API ë¬¸ì„œì— ë”°ë¥´ë©´:
- `acml_tr_pbmn`: **ëˆ„ì  ê±°ëž˜ëŒ€ê¸ˆ** (ë‹¨ìœ„: **ì›**)
- ì‚¼ì„±ì „ìž í•˜ë£¨ ê±°ëž˜ëŒ€ê¸ˆì´ ì•½ 5,000ì–µ ~ 1ì¡°ì›
- API ì‘ë‹µê°’ì´ `500000000000` ~ `1000000000000` ì´ë©´ **ì› ë‹¨ìœ„**

í˜„ìž¬ ì½”ë“œ:
```python
trading_value = float(item.get("acml_tr_pbmn", 0)) / 100_000_000  # ì–µì› ë³€í™˜
```

ì´ê²Œ ë§žë‹¤ë©´ 300ì–µ = `30000000000` ì›ì´ë¯€ë¡œ í•„í„° í†µê³¼í•´ì•¼ í•¨.

**ë¬¸ì œëŠ” APIê°€ 30ê°œë§Œ ë°˜í™˜í•˜ëŠ” ê²ƒì¼ ê°€ëŠ¥ì„± ë†’ìŒ!**

---

## ðŸ”§ ì˜ˆìƒ ìˆ˜ì • ì½”ë“œ

```python
def get_top_trading_value_stocks(self, min_trading_value: float = 300, limit: int = 200):
    """ê±°ëž˜ëŒ€ê¸ˆ ìƒìœ„ ì¢…ëª© ì¡°íšŒ - KOSPI/KOSDAQ ë³„ë„ í˜¸ì¶œ"""
    
    all_stocks = []
    
    # KOSPI ì¡°íšŒ
    kospi_stocks = self._get_volume_rank(market_code="1", limit=100)
    all_stocks.extend(kospi_stocks)
    
    # KOSDAQ ì¡°íšŒ  
    kosdaq_stocks = self._get_volume_rank(market_code="2", limit=100)
    all_stocks.extend(kosdaq_stocks)
    
    # ê±°ëž˜ëŒ€ê¸ˆ í•„í„°ë§
    filtered = [s for s in all_stocks if s.trading_value >= min_trading_value]
    
    # ê±°ëž˜ëŒ€ê¸ˆ ìˆœ ì •ë ¬
    filtered.sort(key=lambda x: x.trading_value, reverse=True)
    
    return filtered[:limit]
```
