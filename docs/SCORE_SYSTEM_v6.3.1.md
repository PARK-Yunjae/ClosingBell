# ClosingBell v6.3.1 점수제 상세

> 백필 = 실시간 동일 로직 | 보너스 점수 포함

---

## 📊 전체 점수 구조 (100점 만점)

```
┌─────────────────────────────────────────────────────────────┐
│                    기본 점수 (90점)                          │
├─────────────────────────────────────────────────────────────┤
│  CCI (15점)      │  등락률 (15점)   │  이격도 (15점)         │
│  연속양봉 (15점)  │  거래량비 (15점) │  캔들품질 (15점)       │
├─────────────────────────────────────────────────────────────┤
│                    보너스 (10점)                             │
├─────────────────────────────────────────────────────────────┤
│  CCI 상승 (4점)  │  MA20 3일↑ (3점) │  고가≠종가 (3점)      │
└─────────────────────────────────────────────────────────────┘
                              ↓
                    점수 순 정렬 → TOP5 선정
```

---

## 1️⃣ v6.3.1 핵심 변경: 백필 = 실시간 동일

### 변경 내용

```
v6.2.3: 백필은 기본 점수만, 실시간은 보너스 포함
v6.3.1: 백필 = 실시간 = 동일한 100점 만점 로직
```

### 보너스 점수 (v6.3.1 백필에 추가됨)

| 보너스 | 점수 | 조건 |
|--------|------|------|
| CCI 상승 | 2.5~4점 | 전일 대비 CCI 상승 |
| MA20 3일↑ | 3점 | MA20이 3일 연속 상승 |
| 고가≠종가 | 3점 | 고가와 종가가 다름 |

---

## 2️⃣ 기본 점수 (90점) - 단순 선형

### CCI (15점)

```
-200 → 0점
   0 → 7.5점
+200 → 15점

계산: (cci + 200) / 400 * 15
```

### 등락률 (15점)

```
0% → 0점
10% → 15점

계산: change_rate / 10 * 15 (0~10% 범위)
```

### 이격도 (15점)

```
0% → 0점
10% → 15점

계산: disparity / 10 * 15 (0~10% 범위)
```

### 연속양봉 (15점)

```
0일 → 0점
3일 → 15점 (최적)
4일+ → 감점 (20%씩)

계산: 
  0~3일: (days / 3) * 15
  4일+: max(0, (1 - (days-3)*0.2)) * 15
```

### 거래량비 (15점)

```
1배 → 0점
5배 → 15점

계산: (ratio - 1) / 4 * 15 (1~5배 범위)
```

### 캔들품질 (15점)

```
양봉: 7.5점
아래꼬리 3%: 7.5점

계산: (is_bullish * 0.5 + min(lower_shadow/3, 1) * 0.5) * 15
```

---

## 3️⃣ 보너스 점수 (10점)

### CCI 상승 (4점)

| 상승폭 | 점수 |
|--------|------|
| 20+ | 4.0점 |
| 10~20 | 3.5점 |
| 5~10 | 3.0점 |
| 0~5 | 2.5점 |
| 하락 | 0점 |

### MA20 3일상승 (3점)

| 조건 | 점수 |
|------|------|
| 3일 연속 상승 | 3.0점 |
| 2일 상승 | 1.5점 |
| 그 외 | 0점 |

### 고가≠종가 (3점)

| 조건 | 점수 |
|------|------|
| 고가 ≠ 종가 | 3.0점 |
| 고가 = 종가 (상한가형) | 0점 |

---

## 4️⃣ 등급별 매도 전략

| 등급 | 점수 | 시초가 매도 | 목표가 | 손절 |
|------|------|-----------|--------|------|
| **S** | 85+ | 30% | +4% | -3% |
| **A** | 75~84 | 40% | +3% | -2.5% |
| **B** | 65~74 | 50% | +2.5% | -2% |
| **C** | 55~64 | 70% | +2% | -1.5% |
| **D** | <55 | 100% | - | -1% |

---

## 5️⃣ 필터 조건 (TV200 일치)

| 항목 | 값 |
|------|-----|
| 최소 거래대금 | 100억원 |
| 등락률 | 0.1% ~ 30% |
| CCI | 하드필터 없음 (점수제 반영) |

---

## 📋 v6.3.1 변경 요약

| 항목 | v6.2.3 | v6.3.1 |
|------|--------|--------|
| 백필 점수 | 기본 90점 | **기본+보너스 100점** |
| 백필 = 실시간 | ❌ 불일치 | **✅ 동일** |
| 거래대금 저장 | ❌ 없음 | **✅ DB 저장** |
| 대시보드 거래대금 | ❌ 없음 | **✅ 표시** |

---

*최종 수정: 2026-01-24*
